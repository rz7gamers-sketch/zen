<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸ™‚ Cheer-Up</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: linear-gradient(135deg, #ffd6e0, #ffe0b2);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
}

.box {
    background: #ffffffdd;
    padding: 28px;
    border-radius: 12px;
    width: 90%;
    max-width: 420px;
    text-align: center;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    position: relative;
    transition: transform 0.2s;
}

.hidden { display: none; }

button {
    padding: 12px 20px;
    margin: 16px 5px 0;
    border-radius: 10px;
    border: 1px solid #222;
    background: #fff;
    cursor: pointer;
    transition: transform 0.2s;
}
button:hover { transform: scale(1.05); }

img { width: 100%; border-radius: 10px; margin-top: 15px; }

.note { font-size: 14px; color: #555; margin-top: 8px; }

.no-btn { position: absolute; right: 20px; top: 60px; }

.glow { color: black; font-weight: bold; animation: bounce 1s infinite; }

@keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

.emoji { position: absolute; font-size: 20px; pointer-events: none; animation: fall linear infinite; }
@keyframes fall { 0% { transform: translateY(-30px); } 100% { transform: translateY(100vh); } }
</style>
</head>
<body>

<!-- STEP 1 -->
<div class="box" id="step1">
    <h3>Mood thik hoise <span class="glow">apu</span>?</h3>
    <button onclick="show('step2')">No</button>
</div>

<!-- STEP 2 -->
<div class="box hidden" id="step2">
    <h3>Accha tahole ki kora jay bolen to</h3>
    <button onclick="show('step3')">Ekta <span class="glow">baddie</span> dekhben?</button>
</div>

<!-- STEP 3 -->
<div class="box hidden" id="step3">
    <img src="her-image.jpg" alt="Baddie">
    <p>Ei <span class="glow">baddie</span> ke sad dekhle manay na, please hashen?</p>

    <input type="file" id="firstSelfie" accept="image/*">
    <div class="note">Selfie ta na dile website ta r agay jabe na</div>
</div>

<!-- STEP 4 -->
<div class="box hidden" id="step4">
    <h3>Ami ki <span class="glow">Batman</span>?</h3>
    <button onclick="show('step5')">Yes</button>
    <button class="no-btn" id="noBtn">No</button>
</div>

<!-- STEP 5 -->
<div class="box hidden" id="step5">
    <h3>Eito good job ðŸ˜Œ<br>dekhi abar ektu hashen to</h3>

    <input type="file" id="secondSelfie" accept="image/*">
    <div class="note">Selfie ta na dile website ta shesh hobe na</div>
</div>

<!-- FINAL PAGE -->
<div class="box hidden" id="final">
    <h3>You know you can still send infinite amount of selfies ðŸ˜‰</h3>
    <input type="file" id="infiniteSelfie" accept="image/*">
    <div class="note">Send as many selfies as you want ðŸ˜‹</div>

    <h4>Your Selfie Gallery</h4>
    <div id="gallery" style="display:flex; flex-wrap: wrap;"></div>
</div>



<script>
// STEP navigation
function show(id){
    document.querySelectorAll('.box').forEach(b => b.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
}

// Moving No button
const noBtn = document.getElementById("noBtn");
noBtn.addEventListener("mouseover", () => {
    const x = Math.random() * (window.innerWidth - 120);
    const y = Math.random() * (window.innerHeight - 60);
    noBtn.style.left = x + "px";
    noBtn.style.top = y + "px";
    shakeBox(document.getElementById('step4'));
});

// Shake animation
function shakeBox(box){
    box.style.transform = "translateX(-10px)";
    setTimeout(()=> box.style.transform = "translateX(10px)",100);
    setTimeout(()=> box.style.transform = "translateX(0)",200);
}

// Selfie upload
function uploadSelfie(inputId, nextStep){
    const fileInput = document.getElementById(inputId);
    fileInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        const formData = new FormData();
        formData.append('selfie', file);

        const res = await fetch('/upload', { method: 'POST', body: formData });
        const data = await res.json();
        console.log(data.message);

        show(nextStep);
        triggerEmojiRain();
        if(nextStep==='final') triggerConfetti();
    });
}

uploadSelfie('firstSelfie','step4');
uploadSelfie('secondSelfie','final');


 // Infinite selfies (final page)
const infiniteInput = document.getElementById('infiniteSelfie');
infiniteInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    const formData = new FormData();
    formData.append('selfie', file);

    const res = await fetch('/upload', { method: 'POST', body: formData });
    const data = await res.json();
    console.log(data.message);

    // Fun effect for every upload
    triggerEmojiRain();

    // Reset input so she can upload again
    infiniteInput.value = '';
});

const gallery = document.getElementById('gallery');

// Function to add a selfie to gallery
function addSelfieToGallery(fileName){
    const img = document.createElement('img');
    img.src = `/uploads/${fileName}`;
    img.style.width = '100px';
    img.style.margin = '5px';
    img.style.borderRadius = '10px';
    gallery.appendChild(img);
}

async function loadGallery() {
    const gallery = document.getElementById('gallery');
    gallery.innerHTML = ''; // clear existing

    const res = await fetch('/selfies');
    const files = await res.json();

    files.forEach(file => {
        const img = document.createElement('img');
        img.src = `/uploads/${file}`;
        img.style.width = '100px';
        img.style.margin = '5px';
        img.style.borderRadius = '10px';
        gallery.appendChild(img);
    });
}

// Call this when showing the final page
function show(id){
    document.querySelectorAll('.box').forEach(b => b.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');

    if(id === 'final') loadGallery(); // load all selfies
}


// Update infinite selfie upload handler
const infiniteInput = document.getElementById('infiniteSelfie');
infiniteInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    const formData = new FormData();
    formData.append('selfie', file);

    const res = await fetch('/upload', { method: 'POST', body: formData });
    const data = await res.json();
    console.log(data.message);

    // Display the uploaded selfie in gallery
    addSelfieToGallery(file.name);

    // Fun effect
    triggerEmojiRain();

    // Clear input
    infiniteInput.value = '';
});

async function loadGallery() {
    const gallery = document.getElementById('gallery');
    gallery.innerHTML = ''; // clear existing

    const res = await fetch('/selfies');
    const files = await res.json();

    files.forEach(file => {
        const img = document.createElement('img');
        img.src = `/uploads/${file}`;
        img.style.width = '100px';
        img.style.margin = '5px';
        img.style.borderRadius = '10px';
        gallery.appendChild(img);
    });
}

// Call this when showing the final page
function show(id){
    document.querySelectorAll('.box').forEach(b => b.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');

    if(id === 'final') loadGallery(); // load all selfies
}



// Emoji rain
function triggerEmojiRain(){
    for(let i=0;i<20;i++){
        const e = document.createElement('div');
        e.className='emoji';
        e.innerText='ðŸ˜‹';
        e.style.left=Math.random()*100+'vw';
        e.style.animationDuration=2+Math.random()*3+'s';
        document.body.appendChild(e);
        setTimeout(()=> e.remove(),5000);
    }
}

// Confetti
function triggerConfetti(){
    for(let i=0;i<50;i++){
        const c = document.createElement('div');
        c.style.position='absolute';
        c.style.width='10px';
        c.style.height='10px';
        c.style.background=['#ff0','#f0f','#0ff','#0f0','#f00'][Math.floor(Math.random()*5)];
        c.style.left=Math.random()*100+'vw';
        c.style.top='0';
        c.style.borderRadius='50%';
        c.style.animation='fall 3s linear forwards';
        document.body.appendChild(c);
        setTimeout(()=> c.remove(),3000);
    }
}
</script>

</body>
</html>
